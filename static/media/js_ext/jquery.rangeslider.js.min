(function(a,b){a.widget("ui.rangeSlider",{options:{bounds:{min:0,max:100},defaultValues:{min:20,max:50},wheelMode:null,wheelSpeed:4,arrows:true,valueLabels:"show",formatter:null,durationIn:0,durationOut:400,delayOut:200,range:{min:false,max:false}},_values:null,bar:null,leftHandle:null,rightHandle:null,innerBar:null,container:null,arrows:null,labels:null,changing:{min:false,max:false},changed:{min:false,max:false},lastWheel:0,lastScroll:0,scrollCount:0,_create:function(){this._values=this.options.defaultValues;this.labels={left:null,right:null,leftDisplayed:true,rightDisplayed:true};this.arrows={left:null,right:null};this.changing={min:false,max:false};this.changed={min:false,max:false};this.leftContainment=a("<div class='ui-rangeSlider-handleContainment ui-rangeSlider-leftContainment' />").css("position","absolute").css("top",0).css("left",0);this.rightContainment=a("<div class='ui-rangeSlider-handleContainment ui-rangeSlider-rightContainment' />").css("top",0).css("left",0);this.leftHandle=a("<div class='ui-rangeSlider-handle  ui-rangeSlider-leftHandle' />").draggable({axis:"x",containment:this.leftContainment,drag:a.proxy(this._handleMoved,this),stop:a.proxy(this._handleStop,this)}).css("position","absolute").css("top",0);this.rightHandle=a("<div class='ui-rangeSlider-handle ui-rangeSlider-rightHandle' />").draggable({axis:"x",containment:this.rightContainment,drag:a.proxy(this._handleMoved,this),stop:a.proxy(this._handleStop,this)}).css("position","absolute").css("top",0);this.innerBar=a("<div class='ui-rangeSlider-innerBar' />").css("position","absolute").css("top",0).css("left",0);this.container=a("<div class='ui-rangeSlider-container' />").css("position","absolute");this.bar=a("<div class='ui-rangeSlider-bar' />").draggable({axis:"x",drag:a.proxy(this._barMoved,this),stop:a.proxy(this._barStop,this),containment:this.container}).css("position","absolute").css("top",0).bind("mousewheel",a.proxy(this._wheelOnBar,this));this.arrows.left=a("<div class='ui-rangeSlider-arrow ui-rangeSlider-leftArrow' />").css("position","absolute").css("left",0).bind("mousedown",a.proxy(this._startScrollLeft,this));this.arrows.right=a("<div class='ui-rangeSlider-arrow ui-rangeSlider-rightArrow' />").css("position","absolute").css("right",0).bind("mousedown",a.proxy(this._startScrollRight,this));a(document).bind("mouseup",a.proxy(this._stopScroll,this));this.container.append(this.leftContainment).append(this.rightContainment).append(this.innerBar).append(this.bar).append(this.leftHandle).append(this.rightHandle);this.element.append(this.container).append(this.arrows.left).append(this.arrows.right).addClass("ui-rangeSlider").bind("mousewheel",a.proxy(this._wheelOnContainer,this));if(this.element.css("position")!=="absolute"){this.element.css("position","relative")}if(!this.options.arrows){this.arrows.left.css("display","none");this.arrows.right.css("display","none");this.element.addClass("ui-rangeSlider-noArrow")}else{this.element.addClass("ui-rangeSlider-withArrows")}if(this.options.valueLabels!=="hide"){this._createLabels()}else{this._destroyLabels()}a(window).resize(a.proxy(this.resize,this));this.option(this.options);setTimeout(a.proxy(this.resize,this),1);setTimeout(a.proxy(this._initValues,this),1)},_initWidth:function(){this.container.css("width",this.element.width()-this.container.outerWidth(true)+this.container.width());this.innerBar.css("width",this.container.width()-this.innerBar.outerWidth(true)+this.innerBar.width());this.leftContainment.css("width",this.container.innerWidth()).css("height",this.container.innerHeight());this.rightContainment.css("width",this.container.innerWidth()).css("height",this.container.innerHeight())},_initValues:function(){this.values(this.options.defaultValues.min,this.options.defaultValues.max)},_setOption:function(d,f){var e=this.options;if(d==="defaultValues"){if((typeof f.min!=="undefined")&&(typeof f.max!=="undefined")&&parseFloat(f.min)===f.min&&parseFloat(f.max)===f.max){this.options.defaultValues=f}}else{if(d==="wheelMode"&&(f==="zoom"||f==="scroll"||f===null)){this.options.wheelMode=f}else{if(d==="wheelSpeed"&&!isNaN(parseFloat(f))&&Math.abs(parseFloat(f))<=100){this.options.wheelSpeed=parseFloat(f)}else{if(d==="arrows"&&(f===true||f===false)&&f!==this.options.arrows){if(f){this.element.removeClass("ui-rangeSlider-noArrow").addClass("ui-rangeSlider-withArrows");this.arrows.left.css("display","block");this.arrows.right.css("display","block")}else{this.element.addClass("ui-rangeSlider-noArrow").removeClass("ui-rangeSlider-withArrows");this.arrows.left.css("display","none");this.arrows.right.css("display","none")}this.options.arrows=f;this._initWidth();this._position()}else{if(d==="valueLabels"&&(f==="hide"||f==="show"||f==="change")){this.options.valueLabels=f;if(f!=="hide"){this._createLabels()}else{this._destroyLabels()}}else{if(d==="formatter"&&f!==null&&typeof f==="function"){this.options.formatter=f;this._position()}else{if(d==="bounds"&&typeof f.min!=="undefined"&&typeof f.max!=="undefined"){this.bounds(f.min,f.max)}else{if(d==="range"){if(f===false){e.range={min:false,max:false};return}var c=f||{};c.min=(parseFloat(c.min)===c.min||c.min===false?c.min:e.range.min);c.max=(parseFloat(c.max)===c.max||c.max===false?c.max:e.range.max);e.range=c;this._initWidth();this._position()}}}}}}}}},_getPosition:function(d,c){return this._getLeftPosition(d,c)+(c===this.rightHandle?c.outerWidth(true):0)},_getLeftPosition:function(d,c){return(d-this.options.bounds.min)*(this.container.innerWidth()-c.outerWidth(true))/(this.options.bounds.max-this.options.bounds.min)},_getValue:function(c,d){if(d===this.rightHandle){c=c-d.outerWidth()}return c*(this.options.bounds.max-this.options.bounds.min)/(this.container.innerWidth()-d.outerWidth(true))+this.options.bounds.min},_privateValues:function(d,c){this._setValues(d,c);this._position();return this._values},_trigger:function(c){this.element.trigger(c,{label:this.element,values:this.values()})},_position:function(){var c=this._getPosition(this._values.min,this.leftHandle),d=this._getPosition(this._values.max,this.rightHandle);this._positionHandles();this.bar.css("left",c).css("width",d-c+this.bar.width()-this.bar.outerWidth(true))},_positionHandles:function(){var f=this._getPosition(this._values.min,this.leftHandle),d=this._getPosition(this._values.max,this.rightHandle)-this.rightHandle.outerWidth(true),c={min:this.options.bounds.min,max:this.options.bounds.max},e={min:this.options.bounds.min,max:this.options.bounds.max};this.leftHandle.css("left",f);this.rightHandle.css("left",d);if(this.options.range.min!==false){c.max=Math.max(this._values.max-this.options.range.min,this.options.bounds.min);e.min=Math.min(this._values.min+this.options.range.min,this.options.bounds.max)}if(this.options.range.max!==false){c.min=Math.max(this._values.max-this.options.range.max,this.options.bounds.min);e.max=Math.min(this._values.min+this.options.range.max,this.options.bounds.max)}f=Math.round(this._getLeftPosition(c.min,this.leftHandle));this.leftContainment.css("margin-left",f).css("width",Math.round(this._getLeftPosition(c.max,this.leftHandle)+this.leftHandle.outerWidth(true))-f);f=Math.round(this._getLeftPosition(e.min,this.rightHandle));this.rightContainment.css("margin-left",f).css("width",Math.round(this._getLeftPosition(e.max,this.rightHandle)+this.rightHandle.outerWidth(true))-f);this._positionLabels()},_barMoved:function(d,e){var f=e.position.left,c=f+this.bar.outerWidth(true);this._setValues(this._getValue(f,this.leftHandle),this._getValue(c,this.rightHandle));this._positionHandles()},_barStop:function(c,d){this._position();this._prepareFiringChanged()},_switchHandles:function(){var c=this.leftHandle;this.leftHandle=this.rightHandle;this.rightHandle=c;this.leftHandle.removeClass("ui-rangeSlider-rightHandle").addClass("ui-rangeSlider-leftHandle");this.rightHandle.addClass("ui-rangeSlider-rightHandle").removeClass("ui-rangeSlider-leftHandle")},_handleMoved:function(f,g){var e=this._values.min,c=this._values.max;if(g.helper[0]===this.leftHandle[0]){e=this._getValue(g.position.left,this.leftHandle)}else{if(g.helper[0]===this.rightHandle[0]){c=this._getValue(g.position.left+g.helper.outerWidth(true),this.rightHandle)}else{return}}if(e>c){this._switchHandles();var d=e;e=c;c=d}this._privateValues(e,c)},_handleStop:function(c,d){this._position();this._prepareFiringChanged()},_changing:function(e,c){this._trigger("valuesChanging");var d=false;if(e&&!this.changing.min){this._trigger("minValueChanging");this.changing.min=true;d=true}if(c&&!this.changing.max){this._trigger("maxValueChanging");this.changing.max=true;d=true}if(d){this._showLabels()}},_prepareFiringChanged:function(){this.lastWheel=Math.random();var c=this.lastWheel;setTimeout(a.proxy(function(){this._fireChanged(c)},this),200)},_fireChanged:function(c){if(this.lastWheel===c&&!this.bar.hasClass("ui-draggable-dragging")&&!this.leftHandle.hasClass("ui-draggable-dragging")&&!this.rightHandle.hasClass("ui-draggable-dragging")){var d=false;if(this.changing.min){this.changing.min=false;this._trigger("minValueChanged");d=true}if(this.changing.max){this.changing.max=false;this._trigger("maxValueChanged");d=true}if(d){this._trigger("valuesChanged")}this._hideLabels()}},_setValuesHandles:function(d,c){this._setValues(d,c);this._positionHandles()},_setValues:function(f,c){var d=this._values,g=Math.abs(c-f);if(g>=this.options.bounds.max-this.options.bounds.min){this._values.min=this.options.bounds.min;this._values.max=this.options.bounds.max}else{var e={min:Math.min(c,f),max:Math.max(f,c)};if(e.min<this.options.bounds.min){e.min=this.options.bounds.min;e.max=e.min+g}else{if(e.max>this.options.bounds.max){e.max=this.options.bounds.max;e.min=e.max-g}}this._values=e}this._changing(d.min!==this._values.min,d.max!==this._values.max);this._prepareFiringChanged()},_startScrollLeft:function(c,d){this.lastScroll=Math.random();this.scrollCount=0;this._continueScrollingRight(-1,this.lastScroll)},_startScrollRight:function(c,d){this.lastScroll=Math.random();this.scrollCount=0;this._continueScrollingRight(1,this.lastScroll)},_continueScrollingRight:function(e,d){if(d===this.lastScroll){var c=Math.min(Math.floor(this.scrollCount/5)+1,4)/4;this.scrollRight(e*c);this.scrollCount++;setTimeout(a.proxy(function(){this._continueScrollingRight(e,d)},this),50)}},_stopScroll:function(c,d){this.lastScroll=Math.random()},_wheelOnBar:function(e,f,d,c){if(this.options.wheelMode==="zoom"){this.zoomIn(-c);return false}},_wheelOnContainer:function(e,f,d,c){if(this.options.wheelMode==="scroll"){this.scrollRight(-c);return false}},_createLabel:function(d,c){if(d===null){d=a("<div class='ui-rangeSlider-label'/>").addClass("ui-rangeSlider-"+c+"Label").css("position","absolute");this.element.append(d)}return d},_destroyLabel:function(c){if(c!==null){c.remove();c=null}return c},_createLabels:function(){this.labels.left=this._createLabel(this.labels.left,"left");this.labels.right=this._createLabel(this.labels.right,"right");if(this.options.valueLabels==="change"){this.labels.left.css("display","none");this.labels.right.css("display","none");this.labels.leftDisplayed=false;this.labels.rightDisplayed=false}else{this.labels.leftDisplayed=true;this.labels.rightDisplayed=true;this.labels.left.css("display","block");this.labels.right.css("display","block");this._position()}this._positionLabels()},_destroyLabels:function(){this.labels.left=this._destroyLabel(this.labels.left);this.labels.right=this._destroyLabel(this.labels.right)},_positionLabel:function(e,c){var d=this.leftHandle.offset().top-e.outerHeight(true),g=e.offsetParent(),f=c-g.offset().left;d=d-g.offset().top;e.css("left",f).css("top",d)},_fillInLabel:function(c,d){c.text(this._format(d))},_fillInLabels:function(){this._fillInLabel(this.labels.left,this._values.min);this._fillInLabel(this.labels.right,this._values.max)},_positionLabels:function(){if(this.labels.left!==null&&this.labels.right!==null){this._fillInLabels();var g=this.labels.leftDisplayed?this.labels.left.outerWidth(true):0,i=this.labels.rightDisplayed?this.labels.right.outerWidth(true):0,e=0,h=a(window).width()-i,c=Math.max(e,this.leftHandle.offset().left+this.leftHandle.outerWidth(true)/2-g/2),d=Math.min(h,this.rightHandle.offset().left+this.rightHandle.outerWidth(true)/2-i/2);if(c+g>=d){var f=c+g-d;c=Math.max(e,c-f/2);d=Math.min(h,c+g);c=Math.max(e,d-g)}if(this.labels.leftDisplayed){this._positionLabel(this.labels.left,c)}if(this.labels.rightDisplayed){this._positionLabel(this.labels.right,d)}}},_format:function(c){if(typeof this.options.formatter!=="undefined"&&this.options.formatter!==null){return this.options.formatter(c)}else{return this._defaultFormat(c)}},_defaultFormat:function(c){return Math.round(c)},_showLabels:function(){if(this.options.valueLabels==="change"&&!this.privateChange){if(this.changing.min&&!this.labels.leftDisplayed){this.labels.left.stop(true,true).fadeIn(this.options.durationIn);this.labels.leftDisplayed=true}if(this.changing.max&&!this.labels.rightDisplayed){this.labels.rightDisplayed=true;this.labels.right.stop(true,true).fadeIn(this.options.durationIn)}}},_hideLabels:function(){if(this.options.valueLabels==="change"&&this.labels.left!==null&&this.labels.right!==null){this.labels.leftDisplayed=false;this.labels.rightDisplayed=false;this.labels.left.stop(true,true).delay(this.options.delayOut).fadeOut(this.options.durationOut);this.labels.right.stop(true,true).delay(this.options.delayOut).fadeOut(this.options.durationOut)}},values:function(d,c){if(typeof d!=="undefined"&&typeof c!=="undefined"){this.internalChange=false;this._privateValues(d,c);this.internalChange=true}return this._values},min:function(c){return this.values(c,this._values.max).min},max:function(c){return this.values(this._values.min,c).max},bounds:function(d,c){if((typeof d!=="undefined")&&(typeof c!=="undefined")&&parseFloat(d)===d&&parseFloat(c)===c&&d<c){this.options.bounds={min:d,max:c};this.values(this._values.min,this._values.max)}return this.options.bounds},zoomIn:function(f){var e=this._values.max-this._values.min,d=this._values.min+f*this.options.wheelSpeed*e/200,c=this._values.max-f*this.options.wheelSpeed*e/200;this._privateValues(d,c)},zoomOut:function(c){this.zoomIn(-c)},scrollLeft:function(c){if(typeof c==="undefined"){c=1}this.scrollRight(-c)},scrollRight:function(f){if(typeof f==="undefined"){f=1}var e=this._values.max-this._values.min,d=this._values.min+f*this.options.wheelSpeed*e/100,c=this._values.max+f*this.options.wheelSpeed*e/100;this._privateValues(d,c)},resize:function(){this._initWidth();this._position()},destroy:function(){this.element.removeClass("ui-rangeSlider-withArrows").removeClass("ui-rangeSlider-noArrow");this.bar.detach();this.leftHandle.detach();this.rightHandle.detach();this.innerBar.detach();this.container.detach();this.arrows.left.detach();this.arrows.right.detach();this.element.removeClass("ui-rangeSlider");this._destroyLabels();delete this.options;a.Widget.prototype.destroy.apply(this,arguments)}})})(jQuery);