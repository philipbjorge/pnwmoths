function Query(a){this.queryString=a}Query.prototype.withQueryString=function(a){this.queryString=a;return this};Query.prototype.withStart=function(a){this.start=a;return this};Query.prototype.withLength=function(a){this.rsLength=a;return this};Query.prototype.withScoringFunction=function(a){this.scoringFunction=a;return this};Query.prototype.withSnippetFields=function(a){if(typeof(a)=="string"){a=a.split(/ *: */)}if(this.snippetFields==null){this.snippetFields=[]}this.snippetFields.push(a);return this};Query.prototype.withFetchFields=function(a){if(typeof(a)=="string"){a=a.split(/ *: */)}if(this.fetchFields==null){this.fetchFields=[]}this.fetchFields.push(a);return this};Query.prototype.withDocumentVariableFilter=function(a,d,b){if(this.documentVariableFilters==null){this.documentVariableFilters=[]}this.documentVariableFilters.push(new Range(id,d,b));return this};Query.prototype.withFunctionFilter=function(a,d,b){if(this.functionFilters==null){this.functionFilters=[]}this.functionFilters.push(new Range(id,d,b));return this};Query.prototype.withCategoryFilters=function(a){if(this.categoryFilters==null){this.categoryFilters={}}for(c in a){this.categoryFilters[c]=a[c]}return this};Query.prototype.withoutCategories=function(a){if(this.categoryFilters==null){this.categoryFilters={}}else{for(idx in a){delete this.categoryFilters[a[idx]]}}return this};Query.prototype.withQueryVariables=function(a){if(this.queryVariables==null){this.queryVariables={}}for(qv in a){this.queryVariables[qv]=a[qv]}return this};Query.prototype.withQueryReWriter=function(a){this.queryReWriter=a;return this};Query.prototype.withFetchVariables=function(a){this.fetchVariables=a;return this};Query.prototype.withFetchCategories=function(a){this.fetchCategories=a;return this};Query.prototype.clone=function(){q=new Query(this.queryString);if(this.start!=null){q.start=this.start}if(this.rsLength!=null){q.rsLength=this.rsLength}if(this.scoringFunction!=null){q.scoringFunction=this.scoringFunction}if(this.snippetFields!=null){q.snippetFields=this.snippetFields}if(this.fetchFields!=null){q.fetchFields=this.fetchFields}if(this.categoryFilters!=null){q.categoryFilters=this.categoryFilters}if(this.documentVariableFilters!=null){q.documentVariableFilters=this.documentVariableFilters}if(this.functionFilters!=null){q.functionFilters=this.functionFilters}if(this.queryVariables!=null){q.queryVariables=this.queryVariables}if(this.queryReWriter!=null){q.queryReWriter=this.queryReWriter}if(this.fetchVariables!=null){q.fetchVariables=this.fetchVariables}if(this.fetchCategories!=null){q.fetchCategories=this.fetchCategories}return q};Query.prototype.asParameterMap=function(){var a={};a.q=this.queryReWriter(this.queryString);if(this.start!=null){a.start=this.start}if(this.rsLength!=null){a.len=this.rsLength}if(this.scoringFunction!=null){a["function"]=this.scoringFunction}if(this.snippetFields!=null){a.snippet=this.snippetFields.join(",")}if(this.fetchFields!=null){a.fetch=this.fetchFields.join(",")}if(this.categoryFilters!=null){a.category_filters=JSON.stringify(this.categoryFilters)}if(this.fetchVariables!=null){a.fetch_variables=this.fetchVariables}if(this.fetchCategories!=null){a.fetch_categories=this.fetchCategories}if(this.documentVariableFilters!=null){for(dvf in this.documentVariableFilters){rng=this.documentVariableFilters[dvf];key=rng.getFilterDocVar();val=rng.getValue();if(a[key]){a[key]+=","+val}else{a[key]=val}}}if(this.functionFilters!=null){for(ff in this.functionFilters){rng=this.functionFilters[ff];key=rng.getFilterFunction();val=rng.getValue();if(a[key]){a[key]+=","+val}else{a[key]=val}}}if(this.queryVariables!=null){for(qv in this.queryVariables){a[qv]=this.queryVariables[qv]}}return a};function Range(d,b,a){this.id=d;this.floor=b;this.ceil=a}Range.prototype.getFilterDocVar=function(){return"filter_docvar"+this.id};Range.prototype.getFilterFunction=function(){return"filter_function"+this.id};Range.prototype.getValue=function(){var a=[(this.floor==null?"*":this.floor),(this.ceil==null?"*":this.ceil)];return a.join(":")};