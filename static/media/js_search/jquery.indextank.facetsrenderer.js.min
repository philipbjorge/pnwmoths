(function(a){if(!a.Indextank){a.Indextank=new Object()}a.Indextank.FacetsRenderer=function(c,b){var d=this;d.$el=a(c);d.el=c;d.$el.data("Indextank.FacetsRenderer",d);d.init=function(){d.options=a.extend({},a.Indextank.FacetsRenderer.defaultOptions,b);d.$el.bind("Indextank.AjaxSearch.success",function(h,i){d.$el.show();d.$el.html("");var f=i.query.categoryFilters||{};var e=a("<ul/>").attr("id","indextank-selected-facets");var g=a("<div/>").attr("id","indextank-available-facets");a.each(i.facets,function(l,o){if(l in f){var n=d.renderSelectedFacet(f,l,i);e.append(n)}else{var m=d.renderAvailableFacet(f,l,o,i);g.append(m)}});var j=a("<div/>").append(e,g);var k=a("<h3/>").text("Filters");d.$el.append(k,j)})};d.renderSelectedFacet=function(e,g,f){$item=a("<li/>");$selectedCategory=a("<span/>").append(a("<a/>").attr("href","#").append(a("<span/>").text(g+" - "+e[g])).click(function(){var h=f.query.clone();h.withoutCategories([g]);h.withStart(0);f.searcher.trigger("Indextank.AjaxSearch.runQuery",[h])}));$item.append($selectedCategory);return $item};d.renderAvailableFacet=function(f,i,e,h){$facetContainer=a("<div/>");$availableFacet=a("<dl/>");$facetContainer.append($availableFacet);$availableFacet.append(a("<dt/>").text(i));var g=[];var j=0;a.each(e,function(k,l){j+=1;g.push([k,l])});g.sort(function(l,k){return k[1]-l[1]});$extraValues=a();if(j>d.options.showableFacets){$more=a("<div/>").addClass("indextank-more-facets").hide();$btn=a("<a/>").attr("href","#").text("more "+i+" options");$extraValues=a("<dl/>");$more.append($extraValues);$btn.click(function(k){a(k.target).parents().children(".indextank-more-facets").toggle()});$facetContainer.append($btn);$facetContainer.append($more)}a.each(g,function(m,o){var l=o[0];var n=o[1];var k=a("<dd/>").append(a("<a/>").attr("href","#").text(l+" ("+n+")").click(function(){var p=h.query.clone();filter={};filter[i]=l;p.withCategoryFilters(filter);p.withStart(0);h.searcher.trigger("Indextank.AjaxSearch.runQuery",[p])}));if(m<d.options.showableFacets){$availableFacet.append(k)}else{$extraValues.append(k)}});return $facetContainer};d.init()};a.Indextank.FacetsRenderer.defaultOptions={showableFacets:4,};a.fn.indextank_FacetsRenderer=function(b){return this.each(function(){(new a.Indextank.FacetsRenderer(this,b))})}})(jQuery);