(function(a){if(!a.Indextank){a.Indextank=new Object()}try{new Query()}catch(b){var c=a("<script/>").attr("src","https://raw.github.com/flaptor/indextank-jquery/master/querybuilder.js");a("head").append(c)}a.Indextank.AjaxSearch=function(e,d){var f=this;f.$el=a(e);f.el=e;f.$el.data("Indextank.AjaxSearch",f);f.init=function(){f.options=a.extend({},a.Indextank.AjaxSearch.defaultOptions,d);f.xhr=undefined;if(f.options.listeners instanceof Array){var g=a();a.map(f.options.listeners,function(j,h){g=g.add(j)});f.options.listeners=g}f.ize=a(f.el.form).data("Indextank.Ize");f.defaultQuery=new Query("").withStart(f.options.start).withLength(f.options.rsLength).withFetchFields(f.options.fields).withSnippetFields(f.options.snippets).withScoringFunction(f.options.scoringFunction).withFetchVariables(f.options.fetchVariables).withFetchCategories(f.options.fetchCategories).withQueryReWriter(f.options.rewriteQuery);f.ize.$el.bind("submit",f.hijackFormSubmit);f.$el.bind("Indextank.AjaxSearch.runQuery",f.runQuery);f.$el.bind("Indextank.AjaxSearch.displayNoResults",f.displayNoResults)};f.displayNoResults=function(){f.options.listeners.trigger("Indextank.AjaxSearch.noResults",f.el.value)};f.getDefaultQuery=function(){return f.defaultQuery.clone()};f.runQuery=function(g,h){if(f.query==h){return}if(f.xhr!=undefined){f.xhr.abort()}f.query=h;f.options.listeners.trigger("Indextank.AjaxSearch.searching");f.$el.trigger("Indextank.AjaxSearch.searching");f.xhr=a.ajax({url:f.ize.apiurl+"/v1/indexes/"+f.ize.indexName+"/search",dataType:"jsonp",data:h.asParameterMap(),timeout:1000,success:function(i){i.query=h;i.searcher=f.$el;f.options.listeners.trigger("Indextank.AjaxSearch.success",i)},error:function(i,k,j){f.options.listeners.trigger("Indextank.AjaxSearch.failure")}})};f.hijackFormSubmit=function(g){g.preventDefault();f.runQuery(g,f.getDefaultQuery().withQueryString(f.el.value))};f.destroy=function(){f.$el.unbind("Indextank.AjaxSearch.runQuery",f.runQuery);f.$el.unbind("Indextank.AjaxSearch.displayNoResults",f.displayNoResults);f.ize.$el.unbind("submit",f.hijackFormSubmit);f.$el.removeData("Indextank.AjaxSearch")};f.init()};a.Indextank.AjaxSearch.defaultOptions={start:0,rsLength:10,fields:"name,title,image,url,link",snippets:"text",listeners:a([]),scoringFunction:0,fetchVariables:"true",fetchCategories:"true",rewriteQuery:function(d){return"text:"+d+"^1 title:"+d+"^10"}};a.fn.indextank_AjaxSearch=function(d){return this.each(function(){(new a.Indextank.AjaxSearch(this,d))})}})(jQuery);