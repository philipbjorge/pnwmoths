var map;var mgr;var county_boundaries_xml;var sites=[];var selected_species;var unique_species;var simple_icon=new GIcon(G_DEFAULT_ICON);simple_icon.image="icon.png";simple_icon.shadow="icon.png";simple_icon.iconAnchor=new GPoint(8,8);simple_icon.infoWindowAnchor=new GPoint(8,8);var icon_sizes=[10,12,16,24];var icon_count=4;var icons=[];for(var i=0;i<icon_count;i++){var icon=new GIcon(simple_icon);var size=icon_sizes[i];icon.iconSize=new GSize(size,size);icon.shadowSize=new GSize(size,size);icons.push(icon)}function Site(){if(this.year!==undefined&&this.year.length>0){var b=parseInt(this.year);if(this.month!==undefined&&this.month.length>0){var d=parseInt(this.month);if(this.day!==undefined&&this.day.length>0){var a=parseInt(this.day)}else{var a=1}}else{var d=1;var a=1}this.date=new Date(b,d-1,a)}else{this.date=null}this.display_date=function(){if(this.year&&this.month&&this.day){return this.month+"/"+this.day+"/"+this.year}else{if(this.year&&this.month){return this.month+"/"+this.year}else{return this.year}}};this.species_name=function(){if(this.genus==""||this.species==""){return""}return this.genus+" "+this.species};this.collection_summary=function(){if(this.date){var e=this.display_date();if(this.collector){e+=" by "+this.collector;if(this.number_of_males){e+=", "+this.number_of_males+" males"}if(this.number_of_females){e+=", "+this.number_of_females+" females"}if(this.collection){e+=" ("+this.collection+")"}}return e}return null}}var month_choices=[["",""],[1,"January"],[2,"February"],[3,"March"],[4,"April"],[5,"May"],[6,"June"],[7,"July"],[8,"August"],[9,"September"],[10,"October"],[11,"November"],[12,"December"]];var all_filters={elevation:new Filter("elevation","Elevation (ft.)",[new Field("startelevation"),new Field("endelevation")]),date:new DateFilter("date","Date",[new Field("startyear"),new ChoiceField("startmonth",{choices:month_choices}),new Field("startday"),new Field("endyear"),new ChoiceField("endmonth",{choices:month_choices}),new Field("endday")])};function clearFilters(){for(var a in all_filters){all_filters[a].unset()}}function createMarker(a,f,e,d){var b=new GMarker(a,d);b.value=f;GEvent.addListener(b,"click",function(){map.openInfoWindowHtml(a,e)});return b}function createSpeciesName(a){if(!a[c.genus]||!a[c.species]){return""}return jQuery.trim(a[c.genus])+" "+jQuery.trim(a[c.species])}function addTerritoryBoundaries(){var a=new GPolygon([new GLatLng(40,-109.5),new GLatLng(53,-109.5),new GLatLng(53,-126),new GLatLng(40,-126),new GLatLng(40,-109.5)],"#0099ff",2,1,"#ccffff",0.2);map.addOverlay(a)}function populateMapBySpecies(f){selected_species=f;mgr.clearMarkers();var h=[];var b={};var o=["site_name","county","state","elevation"];for(var r=0;r<sites.length;r++){var k=sites[r];var g=true;for(key in all_filters){if(all_filters[key].filter(k)===false){g=false;break}}if(!g||!k.latitude||!k.longitude){continue}var a=[k.latitude,k.longitude];if(!b[a]){b[a]={latitude:k.latitude,longitude:k.longitude,precision:k.precision,description:$("<table class='info'></table>"),collectors:[]};b[a].description.append($("<tr><th colspan='2'>"+k.species_name()+"</th></tr>"))}var l=k.collection_summary();if(l){b[a].collectors.push(l)}for(key in o){if(b[a][o[key]]){continue}if(all_filters[o[key]]){var u=all_filters[o[key]].title}else{var u=o[key];u=u.replace(/_/," ");u=u.substr(0,1).toUpperCase()+u.substr(1,u.length-1)}var m="";if(k[o[key]]!==undefined){m=k[o[key]]}b[a][o[key]]=$("<tr><td>"+u+"</td><td>"+m+"</td></tr>")}}var q=0;for(a in b){var n=new GLatLng(parseFloat(b[a].latitude),parseFloat(b[a].longitude));var p=b[a].description;for(key in o){if(b[a][o[key]]){p.append(b[a][o[key]])}}p.append($("<tr><td>GPS coordinates</td><td>"+b[a].latitude+", "+b[a].longitude+"</td></tr>"));if(b[a].collectors.length>0){var d=$("<ul></ul>");for(collector in b[a].collectors){var t=b[a].collectors[collector];d.append($("<li>"+t+"</li>"))}var e=$('<td colspan="2"><h2>Collections</h2></td>');e.append(d);p.append($('<tr id="collections"></tr>').append(e))}p=p.parent().html();var s=getAccuracyIcon(b[a].precision);marker_options={icon:icons[s]};h.push(createMarker(n,q,p,marker_options));q++}mgr.addMarkers(h,3,10);mgr.refresh();return false}function getAccuracyIcon(a){var b;if(a==1){b=3}else{if(a==2){b=2}else{if(a==3){b=1}else{b=0}}}return b}function prepareLinks(){var e=$("<ul></ul>");for(i in unique_species){species_a=$("<a href='#'>"+unique_species[i]+"</a>");species_a.click(function(){$(this).parent().parent().find(".selected").removeClass("selected");$(this).addClass("selected");$("#status").text("Loading...");getSites($(this).text())});e.append($("<li></li>").append(species_a))}$("#species").append(e);var f=$("<input type='checkbox' name='toggle_counties' id='toggle_counties' checked='checked' />");f.change(function(){if($(this).attr("checked")===true&&county_boundaries_xml.isHidden()){county_boundaries_xml.show()}else{county_boundaries_xml.hide()}});$("#filters").before($("<form></form>").append($("<p><label for='toggle_counties'>Toggle county borders</label></p>").prepend(f)));var a=$("#clear-filters");a.click(function(){$("#filters .selected").removeClass("selected");$("#filters .all").addClass("selected");clearFilters();if(selected_species){populateMapBySpecies(selected_species)}return false});for(field in all_filters){var b=all_filters[field];clear_filter_link=$("#clear-filter-"+field);clear_filter_link.attr("name",field);clear_filter_link.click(function(){$(this).parent().parent().find(".selected").removeClass("selected");$(this).addClass("selected");var g=$(this).attr("name");all_filters[g].unset();if(selected_species){populateMapBySpecies(selected_species)}return false});var d=b.prepare()}$("#filters").toggle();$(":text").labelify({labelledClass:"label-highlight"})}$(document).ready(function(){if(!GBrowserIsCompatible()){$("#status").html("<p>Sorry, your browser is not compatible with the current version of Google Maps.</p><p>For more information, visit <a href='http://local.google.com/support/bin/answer.py?answer=16532&topic=1499'>Google's browser support page</a>.</p>");return}map=new GMap2(document.getElementById("map"));map.setCenter(new GLatLng(46.9,-118),5);map.addControl(new GLargeMapControl());map.addControl(new GMapTypeControl());map.addMapType(G_PHYSICAL_MAP);map.setMapType(G_PHYSICAL_MAP);addTerritoryBoundaries();county_boundaries_xml=new GGeoXml("http://www.biol.wwu.edu/~huddlej/pnwmoths/counties9.kml");map.addOverlay(county_boundaries_xml);mgr=new MarkerManager(map);try{var b=$("#title").text();b=b.split(" - ");selected_species=b[0];getSites(selected_species)}catch(a){}});function load(){};